# ç”¨æˆ·è¡¨è®¾ç½®æŒ‡å—

## ğŸ“‹ é—®é¢˜è¯´æ˜

å½“ä½ é€šè¿‡ Supabase Auth æ³¨å†Œæ–°ç”¨æˆ·æ—¶ï¼Œç”¨æˆ·ä¿¡æ¯ä¼šè‡ªåŠ¨å­˜å‚¨åœ¨ `auth.users` è¡¨ä¸­ï¼ˆè¿™æ˜¯ Supabase çš„ç³»ç»Ÿè¡¨ï¼‰ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ éœ€è¦ä¸€ä¸ªè‡ªå®šä¹‰çš„ `users` è¡¨æ¥å­˜å‚¨é¢å¤–çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆå¦‚æ˜µç§°ã€å¤´åƒã€ä¸ªäººç®€ä»‹ç­‰ï¼‰ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºã€‚

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### æ­¥éª¤ 1ï¼šåˆ›å»º users è¡¨å’Œè§¦å‘å™¨

1. æ‰“å¼€ Supabase Dashboard
2. è¿›å…¥ **SQL Editor**
3. å¤åˆ¶å¹¶æ‰§è¡Œ `create_users_table.sql` æ–‡ä»¶ä¸­çš„ SQL è„šæœ¬

è¿™ä¸ªè„šæœ¬ä¼šï¼š
- âœ… åˆ›å»º `users` è¡¨ï¼ˆå­˜å‚¨ç”¨æˆ·é¢å¤–ä¿¡æ¯ï¼‰
- âœ… åˆ›å»ºè§¦å‘å™¨ï¼ˆè‡ªåŠ¨åœ¨æ³¨å†Œæ—¶åˆ›å»ºç”¨æˆ·è®°å½•ï¼‰
- âœ… åŒæ­¥å·²å­˜åœ¨çš„ç”¨æˆ·åˆ° `users` è¡¨

### æ­¥éª¤ 2ï¼šéªŒè¯è®¾ç½®

æ‰§è¡Œä»¥ä¸‹ SQL æŸ¥è¯¢æ¥éªŒè¯ï¼š

```sql
-- æŸ¥çœ‹ users è¡¨ä¸­çš„æ‰€æœ‰ç”¨æˆ·
SELECT * FROM users ORDER BY created_at DESC;

-- æŸ¥çœ‹ auth.users å’Œ users è¡¨çš„ç”¨æˆ·æ•°é‡å¯¹æ¯”
SELECT 
    (SELECT COUNT(*) FROM auth.users) as auth_users_count,
    (SELECT COUNT(*) FROM users) as users_count;
```

### æ­¥éª¤ 3ï¼šæµ‹è¯•æ–°ç”¨æˆ·æ³¨å†Œ

1. åœ¨å‰ç«¯æ³¨å†Œä¸€ä¸ªæ–°ç”¨æˆ·
2. æ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢æ£€æŸ¥ï¼š

```sql
-- æŸ¥çœ‹æœ€æ–°æ³¨å†Œçš„ç”¨æˆ·
SELECT * FROM users ORDER BY created_at DESC LIMIT 5;
```

## ğŸ“Š users è¡¨ç»“æ„

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `id` | UUID | ä¸»é”®ï¼Œå…³è” `auth.users(id)` |
| `email` | TEXT | ç”¨æˆ·é‚®ç®± |
| `name` | TEXT | ç”¨æˆ·æ˜µç§°ï¼ˆé»˜è®¤ä¸ºé‚®ç®±ç”¨æˆ·åéƒ¨åˆ†ï¼‰ |
| `avatar_url` | TEXT | å¤´åƒ URLï¼ˆå¯é€‰ï¼‰ |
| `bio` | TEXT | ä¸ªäººç®€ä»‹ï¼ˆå¯é€‰ï¼‰ |
| `created_at` | TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| `updated_at` | TIMESTAMP | æ›´æ–°æ—¶é—´ |

## ğŸ”„ è‡ªåŠ¨åŒæ­¥æœºåˆ¶

è§¦å‘å™¨ `on_auth_user_created` ä¼šåœ¨ä»¥ä¸‹æƒ…å†µè‡ªåŠ¨æ‰§è¡Œï¼š
- âœ… ç”¨æˆ·é€šè¿‡å‰ç«¯æ³¨å†Œ
- âœ… ç”¨æˆ·é€šè¿‡ Supabase Dashboard åˆ›å»º
- âœ… ç”¨æˆ·é€šè¿‡ API æ³¨å†Œ

æ¯æ¬¡æ–°ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨ `users` è¡¨ä¸­åˆ›å»ºå¯¹åº”çš„è®°å½•ã€‚

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰ users è¡¨ï¼Ÿ

A: `auth.users` æ˜¯ Supabase çš„ç³»ç»Ÿè¡¨ï¼Œä¸»è¦ç”¨äºè®¤è¯ã€‚è‡ªå®šä¹‰ `users` è¡¨å¯ä»¥ï¼š
- å­˜å‚¨é¢å¤–çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆæ˜µç§°ã€å¤´åƒã€ä¸ªäººç®€ä»‹ç­‰ï¼‰
- æ›´å¥½åœ°æ§åˆ¶ç”¨æˆ·æ•°æ®çš„è®¿é—®æƒé™
- æ–¹ä¾¿æ‰©å±•ç”¨æˆ·ç›¸å…³çš„åŠŸèƒ½

### Q: å¦‚æœè§¦å‘å™¨æ²¡æœ‰æ‰§è¡Œæ€ä¹ˆåŠï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. è§¦å‘å™¨æ˜¯å¦æ­£ç¡®åˆ›å»ºï¼š`SELECT * FROM pg_trigger WHERE tgname = 'on_auth_user_created';`
2. RLS ç­–ç•¥æ˜¯å¦æ­£ç¡®ï¼šç¡®ä¿ `System can insert users` ç­–ç•¥å­˜åœ¨
3. æ‰‹åŠ¨åŒæ­¥å·²å­˜åœ¨çš„ç”¨æˆ·ï¼šè¿è¡Œè„šæœ¬ä¸­çš„åŒæ­¥ SQL

### Q: å¦‚ä½•æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼Ÿ

A: å¯ä»¥é€šè¿‡å‰ç«¯ä»£ç æ›´æ–°ï¼š

```javascript
const { data, error } = await supabase
  .from('users')
  .update({ 
    name: 'æ–°æ˜µç§°',
    bio: 'ä¸ªäººç®€ä»‹'
  })
  .eq('id', userId);
```

## ğŸš€ ä¸‹ä¸€æ­¥

åˆ›å»º `users` è¡¨åï¼Œä½ å¯ä»¥ï¼š
1. åœ¨å‰ç«¯æ˜¾ç¤ºç”¨æˆ·æ˜µç§°å’Œå¤´åƒ
2. å…è®¸ç”¨æˆ·ç¼–è¾‘ä¸ªäººèµ„æ–™
3. åœ¨å¸–å­ã€è¯„è®ºä¸­æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯

## ğŸ“ ç›¸å…³æ–‡ä»¶

- `create_users_table.sql` - åˆ›å»º users è¡¨çš„ SQL è„šæœ¬
- `database_setup.sql` - å…¶ä»–æ•°æ®åº“è¡¨çš„åˆ›å»ºè„šæœ¬