# 生成测试数据指南

## 📋 快速开始

### 方法一：完整流程（推荐）

1. **确保已有用户账号**
   - 在应用中注册至少一个账号（使用验证码登录注册）
   - 或者查看现有用户：在 Supabase SQL Editor 中执行
     ```sql
     SELECT id, email, created_at FROM auth.users ORDER BY created_at DESC;
     ```

2. **执行数据插入脚本**
   - 打开 Supabase Dashboard → SQL Editor
   - 复制 `insert_test_data.sql` 的全部内容
   - 粘贴并执行
   - 脚本会自动：
     - 检测现有用户
     - 插入30条帖子数据
     - 插入点赞、评论、收藏数据
     - 插入地图便便和建筑数据
     - 更新统计数据

---

## 📝 SQL 脚本说明

### 1. `insert_test_data.sql` - 主数据插入脚本

**功能：**
- ✅ 自动获取现有用户ID（支持1-3个用户）
- ✅ 插入30条有趣的帖子
- ✅ 插入点赞数据（为前10个帖子）
- ✅ 插入评论数据（为前15个帖子，共50条）
- ✅ 插入收藏数据（为前8个帖子）
- ✅ 插入地图便便数据（15条）
- ✅ 插入建筑数据（5条）
- ✅ 自动更新帖子统计（点赞数、评论数）

**使用方法：**
```sql
-- 直接复制 insert_test_data.sql 的全部内容到 SQL Editor 执行
```

**注意事项：**
- 需要至少1个用户账号（如果没有会报错提示）
- 如果只有1个用户，会重复使用该用户ID
- 如果有多于3个用户，会使用前3个

---

### 2. `insert_test_data_without_user.sql` - 用户检查脚本

**功能：**
- ✅ 检查是否存在用户
- ✅ 如果不存在，提供详细的创建用户指导

**使用方法：**
```sql
-- 先执行此脚本检查是否有用户
-- 如果没有用户，按照提示创建用户后再执行 insert_test_data.sql
```

---

### 3. `create_test_user.sql` - 用户创建指导

**功能：**
- ✅ 提供创建用户的三种方法说明
- ✅ 验证用户是否存在的查询

**使用方法：**
- 这是一个指导文档，不是可执行的SQL
- 按照其中的说明创建用户

---

## 🚀 执行步骤

### 步骤1：检查用户

在 Supabase SQL Editor 中执行：

```sql
SELECT id, email, created_at 
FROM auth.users 
ORDER BY created_at DESC;
```

**如果没有用户：**
1. 在应用中注册账号（推荐）
   - 打开应用
   - 输入邮箱，点击"发送验证码"
   - 输入验证码完成注册

2. 或在 Supabase Dashboard 中创建
   - Dashboard → Authentication → Users
   - 点击 "Add User"
   - 填写邮箱和密码

### 步骤2：执行数据插入脚本

1. 打开 `insert_test_data.sql` 文件
2. 复制全部内容
3. 在 Supabase SQL Editor 中粘贴
4. 点击 "Run" 执行

### 步骤3：验证数据

执行完成后，运行以下查询验证：

```sql
-- 查看帖子数量
SELECT COUNT(*) as post_count FROM posts;

-- 查看帖子列表（最新10条）
SELECT id, text_content, likes_count, comments_count, created_at 
FROM posts 
ORDER BY created_at DESC 
LIMIT 10;

-- 查看统计数据
SELECT 
    (SELECT COUNT(*) FROM posts) as posts,
    (SELECT COUNT(*) FROM likes) as likes,
    (SELECT COUNT(*) FROM comments) as comments,
    (SELECT COUNT(*) FROM favorites) as favorites,
    (SELECT COUNT(*) FROM map_poops) as poops,
    (SELECT COUNT(*) FROM buildings) as buildings;
```

---

## 📊 生成的数据内容

### 帖子数据（30条）
- 包含各种有趣的打工人吐槽内容
- 包含emoji表情
- 时间分布：最近12天
- 自动设置点赞数和评论数

### 点赞数据
- 为前10个帖子添加点赞
- 随机分配用户

### 评论数据（50条）
- 为前15个帖子添加评论
- 包含10种不同的评论内容

### 收藏数据
- 为前8个帖子添加收藏
- 随机分配用户

### 地图便便数据（15条）
- 分布在不同的地图位置（0-99）
- 时间分布：最近5天

### 建筑数据（5条）
- 包含不同类型的建筑名称
- 分布在不同位置

---

## ⚠️ 常见问题

### Q: 执行时提示"没有找到用户"
**A:** 需要先创建用户账号，参考步骤1

### Q: 数据插入后没有显示
**A:** 
1. 检查RLS策略是否正确设置
2. 确认用户已登录
3. 刷新前端页面

### Q: 想重新生成数据
**A:** 
1. 先执行 `drop_all_tables_simple.sql` 删除所有数据
2. 重新执行 `insert_test_data.sql`

### Q: 想修改数据内容
**A:** 
- 直接编辑 `insert_test_data.sql` 文件
- 修改帖子内容、数量等
- 重新执行脚本

---

## 📁 相关文件

- `insert_test_data.sql` - **主要数据插入脚本**（使用这个）
- `insert_test_data_without_user.sql` - 用户检查脚本
- `create_test_user.sql` - 用户创建指导
- `database_setup.sql` - 数据库表结构创建脚本
- `drop_all_tables_simple.sql` - 删除所有数据的脚本

---

## 💡 提示

1. **首次使用：** 先执行 `database_setup.sql` 创建表结构
2. **生成数据：** 执行 `insert_test_data.sql` 插入测试数据
3. **重新生成：** 先删除再插入，或直接执行插入脚本（会更新现有数据）
