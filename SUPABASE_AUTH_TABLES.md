# Supabase è®¤è¯æ•°æ®å­˜å‚¨è¯´æ˜

## ğŸ“Š ç”¨æˆ·æ³¨å†Œåçš„æ•°æ®å­˜å‚¨ä½ç½®

å½“ä½ æ³¨å†Œæ–°è´¦å·æ—¶ï¼ŒSupabase ä¼šè‡ªåŠ¨å°†æ•°æ®å­˜å‚¨åœ¨ä»¥ä¸‹ç³»ç»Ÿè¡¨ä¸­ï¼š

### 1. `auth.users` è¡¨ï¼ˆç”¨æˆ·è´¦æˆ·è¡¨ï¼‰

**å­˜å‚¨å†…å®¹ï¼š**
- âœ… `id` - ç”¨æˆ·å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆUUIDï¼‰
- âœ… `email` - ç”¨æˆ·é‚®ç®±
- âœ… `created_at` - è´¦æˆ·åˆ›å»ºæ—¶é—´
- âœ… `updated_at` - æœ€åæ›´æ–°æ—¶é—´
- âœ… `email_confirmed_at` - é‚®ç®±ç¡®è®¤æ—¶é—´ï¼ˆå¦‚æœå·²éªŒè¯ï¼‰
- âœ… `encrypted_password` - åŠ å¯†åçš„å¯†ç ï¼ˆå“ˆå¸Œå€¼ï¼‰
- âœ… `raw_user_meta_data` - ç”¨æˆ·å…ƒæ•°æ®ï¼ˆJSONï¼‰
- âœ… `raw_app_meta_data` - åº”ç”¨å…ƒæ•°æ®ï¼ˆJSONï¼‰

**æŸ¥çœ‹æ–¹å¼ï¼š**
```sql
-- åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œ
SELECT id, email, created_at, email_confirmed_at 
FROM auth.users 
ORDER BY created_at DESC;
```

**è®¿é—®ä½ç½®ï¼š**
- Supabase Dashboard â†’ **Authentication** â†’ **Users** æ ‡ç­¾é¡µ
- æˆ–é€šè¿‡ SQL Editor æŸ¥è¯¢ `auth.users` è¡¨

---

### 2. `auth.sessions` è¡¨ï¼ˆä¼šè¯è¡¨ï¼‰

**å­˜å‚¨å†…å®¹ï¼š**
- âœ… `id` - ä¼šè¯ IDï¼ˆUUIDï¼‰
- âœ… `user_id` - å…³è”çš„ç”¨æˆ· ID
- âœ… `access_token` - è®¿é—®ä»¤ç‰Œï¼ˆJWTï¼‰
- âœ… `refresh_token` - åˆ·æ–°ä»¤ç‰Œ
- âœ… `expires_at` - ä¼šè¯è¿‡æœŸæ—¶é—´ï¼ˆUnix æ—¶é—´æˆ³ï¼‰
- âœ… `created_at` - ä¼šè¯åˆ›å»ºæ—¶é—´
- âœ… `updated_at` - æœ€åæ›´æ–°æ—¶é—´

**æŸ¥çœ‹æ–¹å¼ï¼š**
```sql
-- æŸ¥çœ‹å½“å‰æ´»è·ƒä¼šè¯
SELECT 
    id,
    user_id,
    expires_at,
    created_at
FROM auth.sessions
ORDER BY created_at DESC
LIMIT 10;
```

**æ³¨æ„ï¼š** å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œ`access_token` å’Œ `refresh_token` é€šå¸¸ä¸ä¼šç›´æ¥æ˜¾ç¤ºåœ¨æŸ¥è¯¢ç»“æœä¸­ã€‚

---

### 3. `auth.refresh_tokens` è¡¨ï¼ˆåˆ·æ–°ä»¤ç‰Œè¡¨ï¼‰

**å­˜å‚¨å†…å®¹ï¼š**
- âœ… `id` - åˆ·æ–°ä»¤ç‰Œ ID
- âœ… `user_id` - å…³è”çš„ç”¨æˆ· ID
- âœ… `token` - åˆ·æ–°ä»¤ç‰Œï¼ˆå“ˆå¸Œå€¼ï¼‰
- âœ… `expires_at` - è¿‡æœŸæ—¶é—´

---

## ğŸ” å¦‚ä½•æŸ¥çœ‹è¿™äº›æ•°æ®

### æ–¹æ³• 1ï¼šé€šè¿‡ Supabase Dashboard

1. **æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯ï¼š**
   - è¿›å…¥ Supabase Dashboard
   - ç‚¹å‡»å·¦ä¾§èœå• **Authentication** â†’ **Users**
   - å¯ä»¥çœ‹åˆ°æ‰€æœ‰æ³¨å†Œçš„ç”¨æˆ·åˆ—è¡¨

2. **æŸ¥çœ‹ä¼šè¯ä¿¡æ¯ï¼š**
   - åœ¨ SQL Editor ä¸­æ‰§è¡ŒæŸ¥è¯¢ï¼ˆè§ä¸‹æ–¹ï¼‰

### æ–¹æ³• 2ï¼šé€šè¿‡ SQL Editor æŸ¥è¯¢

```sql
-- 1. æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
SELECT 
    id,
    email,
    created_at,
    email_confirmed_at,
    last_sign_in_at
FROM auth.users
ORDER BY created_at DESC;

-- 2. æŸ¥çœ‹ç‰¹å®šç”¨æˆ·çš„ä¿¡æ¯
SELECT 
    id,
    email,
    created_at,
    raw_user_meta_data
FROM auth.users
WHERE email = 'bubbbbble.hu@gmail.com';

-- 3. æŸ¥çœ‹æ´»è·ƒä¼šè¯ï¼ˆç®€åŒ–ç‰ˆï¼‰
SELECT 
    s.id as session_id,
    u.email,
    s.expires_at,
    s.created_at
FROM auth.sessions s
JOIN auth.users u ON s.user_id = u.id
ORDER BY s.created_at DESC
LIMIT 10;
```

---

## ğŸ“‹ æ•°æ®æµç¨‹è¯´æ˜

### æ³¨å†Œæµç¨‹ï¼š

```
ç”¨æˆ·æ³¨å†Œ
    â†“
Supabase Auth å¤„ç†
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. auth.users è¡¨        â”‚ â† åˆ›å»ºç”¨æˆ·è®°å½•
â”‚    - id                 â”‚
â”‚    - email              â”‚
â”‚    - created_at         â”‚
â”‚    - encrypted_password â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. auth.sessions è¡¨    â”‚ â† åˆ›å»ºä¼šè¯ï¼ˆå¦‚æœè‡ªåŠ¨ç™»å½•ï¼‰
â”‚    - user_id            â”‚
â”‚    - access_token       â”‚
â”‚    - expires_at         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
å‰ç«¯æ”¶åˆ°å“åº”
    â†“
æ§åˆ¶å°æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯å’Œä¼šè¯ä¿¡æ¯
```

---

## ğŸ†š ç³»ç»Ÿè¡¨ vs è‡ªå®šä¹‰è¡¨

### ç³»ç»Ÿè¡¨ï¼ˆSupabase è‡ªåŠ¨ç®¡ç†ï¼‰

| è¡¨å | ç”¨é€” | æ˜¯å¦å¯ä¿®æ”¹ |
|------|------|-----------|
| `auth.users` | å­˜å‚¨ç”¨æˆ·è´¦æˆ·ä¿¡æ¯ | âŒ åªè¯»ï¼ˆé€šè¿‡ Supabase APIï¼‰ |
| `auth.sessions` | å­˜å‚¨ç”¨æˆ·ä¼šè¯ | âŒ åªè¯»ï¼ˆé€šè¿‡ Supabase APIï¼‰ |
| `auth.refresh_tokens` | å­˜å‚¨åˆ·æ–°ä»¤ç‰Œ | âŒ åªè¯»ï¼ˆé€šè¿‡ Supabase APIï¼‰ |

### è‡ªå®šä¹‰è¡¨ï¼ˆéœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼‰

| è¡¨å | ç”¨é€” | æ˜¯å¦å¯ä¿®æ”¹ |
|------|------|-----------|
| `public.users` | å­˜å‚¨ç”¨æˆ·é¢å¤–ä¿¡æ¯ï¼ˆæ˜µç§°ã€å¤´åƒç­‰ï¼‰ | âœ… å¯åˆ›å»ºå’Œä¿®æ”¹ |
| `public.posts` | å­˜å‚¨ç”¨æˆ·å‘å¸ƒçš„å¸–å­ | âœ… å¯åˆ›å»ºå’Œä¿®æ”¹ |
| `public.comments` | å­˜å‚¨è¯„è®º | âœ… å¯åˆ›å»ºå’Œä¿®æ”¹ |

---

## ğŸ’¡ é‡è¦è¯´æ˜

### 1. `auth.users` æ˜¯ç³»ç»Ÿè¡¨

- âœ… Supabase è‡ªåŠ¨ç®¡ç†ï¼Œæ— éœ€æ‰‹åŠ¨åˆ›å»º
- âœ… ç”¨æˆ·æ³¨å†Œæ—¶è‡ªåŠ¨åˆ›å»ºè®°å½•
- âœ… ä¸èƒ½ç›´æ¥é€šè¿‡ SQL INSERT æ’å…¥æ•°æ®
- âœ… å¿…é¡»é€šè¿‡ Supabase Auth API æ“ä½œ

### 2. ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰ `users` è¡¨ï¼Ÿ

è™½ç„¶ `auth.users` å­˜å‚¨äº†åŸºæœ¬çš„è®¤è¯ä¿¡æ¯ï¼Œä½†å¦‚æœä½ éœ€è¦ï¼š
- å­˜å‚¨ç”¨æˆ·æ˜µç§°ã€å¤´åƒã€ä¸ªäººç®€ä»‹
- å­˜å‚¨ç”¨æˆ·ç­‰çº§ã€ç§¯åˆ†ç­‰ä¸šåŠ¡æ•°æ®
- æ›´å¥½çš„æ•°æ®è®¿é—®æ§åˆ¶

å°±éœ€è¦åˆ›å»ºè‡ªå®šä¹‰çš„ `public.users` è¡¨ï¼ˆå‚è€ƒ `create_users_table.sql`ï¼‰ã€‚

### 3. æ•°æ®åŒæ­¥

å¦‚æœåˆ›å»ºäº†è‡ªå®šä¹‰ `users` è¡¨ï¼Œå¯ä»¥é€šè¿‡è§¦å‘å™¨è‡ªåŠ¨åŒæ­¥ï¼š
- æ–°ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œè‡ªåŠ¨åœ¨ `public.users` ä¸­åˆ›å»ºè®°å½•
- ä¿æŒ `auth.users` å’Œ `public.users` çš„æ•°æ®ä¸€è‡´

---

## ğŸ” å®‰å…¨æ³¨æ„äº‹é¡¹

1. **å¯†ç å­˜å‚¨ï¼š**
   - å¯†ç ä»¥åŠ å¯†å“ˆå¸Œå½¢å¼å­˜å‚¨åœ¨ `auth.users.encrypted_password`
   - æ°¸è¿œä¸ä¼šä»¥æ˜æ–‡å½¢å¼å­˜å‚¨æˆ–ä¼ è¾“

2. **Token å®‰å…¨ï¼š**
   - `access_token` å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ localStorageï¼‰
   - `refresh_token` ä¹Ÿå­˜å‚¨åœ¨å®¢æˆ·ç«¯
   - æœåŠ¡å™¨ç«¯åªå­˜å‚¨å“ˆå¸Œå€¼

3. **è®¿é—®é™åˆ¶ï¼š**
   - `auth.*` è¡¨åªèƒ½é€šè¿‡ Supabase API è®¿é—®
   - ä¸èƒ½ç›´æ¥é€šè¿‡ SQL ä¿®æ”¹ï¼ˆé™¤éä½¿ç”¨ `SECURITY DEFINER` å‡½æ•°ï¼‰

---

## ğŸ“ æ€»ç»“

**ä½ çœ‹åˆ°çš„æ§åˆ¶å°ä¿¡æ¯å­˜å‚¨ä½ç½®ï¼š**

| ä¿¡æ¯ | å­˜å‚¨è¡¨ | è¯´æ˜ |
|------|--------|------|
| `id` | `auth.users` | ç”¨æˆ·å”¯ä¸€æ ‡è¯† |
| `email` | `auth.users` | ç”¨æˆ·é‚®ç®± |
| `created_at` | `auth.users` | è´¦æˆ·åˆ›å»ºæ—¶é—´ |
| `access_token` | `auth.sessions` | è®¿é—®ä»¤ç‰Œï¼ˆå®¢æˆ·ç«¯ä¹Ÿå­˜å‚¨ï¼‰ |
| `expires_at` | `auth.sessions` | ä¼šè¯è¿‡æœŸæ—¶é—´ |

**æŸ¥çœ‹æ–¹å¼ï¼š**
- Dashboard: Authentication â†’ Users
- SQL Editor: `SELECT * FROM auth.users;`

**å¦‚æœéœ€è¦å­˜å‚¨é¢å¤–ä¿¡æ¯ï¼š**
- æ‰§è¡Œ `create_users_table.sql` åˆ›å»ºè‡ªå®šä¹‰ `users` è¡¨
- è§¦å‘å™¨ä¼šè‡ªåŠ¨åŒæ­¥æ–°æ³¨å†Œçš„ç”¨æˆ·