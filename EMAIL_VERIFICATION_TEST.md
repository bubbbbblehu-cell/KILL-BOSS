# ✅ 邮箱验证码功能测试清单

## 📋 测试前准备

### 1. 配置检查

- [ ] 已获取 Supabase API Key
- [ ] 已更新 `src/js/config.js` 中的 key
- [ ] 已刷新浏览器页面
- [ ] 控制台显示 ✅ 配置正确

**检查命令**:
```javascript
checkSupabaseConfig()
```

### 2. 网络检查

- [ ] 可以访问 Supabase Dashboard
- [ ] 可以访问 CDN (cdn.jsdelivr.net)
- [ ] 浏览器控制台无脚本加载错误

## 🧪 功能测试

### 测试 1: 发送验证码

**步骤**:
1. 打开应用登录页面
2. 输入邮箱地址（如：test@gmail.com）
3. 点击"发送验证码"按钮

**预期结果**:
- [ ] 按钮显示"发送中..."
- [ ] 显示成功提示："验证码已发送至邮箱，请查收"
- [ ] 验证码输入框显示
- [ ] "发送验证码"按钮隐藏
- [ ] "登录"按钮显示
- [ ] 开始 60 秒倒计时

**可能的错误**:
- ❌ "Supabase 对象未定义" → 检查 API Key 配置
- ❌ "发送验证码过于频繁" → 等待或使用其他邮箱
- ❌ "邮箱格式不正确" → 检查邮箱格式

### 测试 2: 接收验证码邮件

**步骤**:
1. 打开邮箱收件箱
2. 查找来自 Supabase 的邮件
3. 如果收件箱没有，检查垃圾邮件文件夹

**预期结果**:
- [ ] 收到邮件（可能需要 1-2 分钟）
- [ ] 邮件包含 6 位数字验证码
- [ ] 验证码清晰可见

**可能的问题**:
- ❌ 收不到邮件 → 检查垃圾邮件文件夹
- ❌ 邮件延迟 → 等待 2-3 分钟
- ❌ 完全收不到 → 配置 SMTP 或在 Dashboard 创建用户

### 测试 3: 验证码登录

**步骤**:
1. 在验证码输入框输入 6 位验证码
2. 点击"登录"按钮

**预期结果**:
- [ ] 按钮显示"验证中..."
- [ ] 显示成功提示："登录成功！欢迎回来 🎉"
- [ ] 自动跳转到首页（滑一滑页面）
- [ ] 个人中心显示用户邮箱

**可能的错误**:
- ❌ "验证码错误或已过期" → 重新发送验证码
- ❌ "验证失败" → 检查验证码是否正确

### 测试 4: 自动创建用户

**步骤**:
1. 使用从未注册过的邮箱
2. 发送验证码并登录

**预期结果**:
- [ ] 登录成功
- [ ] 自动创建新用户
- [ ] 可以在 Supabase Dashboard → Users 中看到新用户

**验证方法**:
访问: https://supabase.com/dashboard/project/rjqdxxwurocqsewvtduf/auth/users

### 测试 5: 会话保持

**步骤**:
1. 登录成功后
2. 刷新页面（F5）

**预期结果**:
- [ ] 保持登录状态
- [ ] 不需要重新登录
- [ ] 直接显示首页

### 测试 6: 登出功能

**步骤**:
1. 点击底部导航"我的"
2. 点击"退出登录"

**预期结果**:
- [ ] 返回登录页面
- [ ] 清除登录状态
- [ ] 邮箱输入框保留上次登录的邮箱

### 测试 7: 游客模式

**步骤**:
1. 在登录页面点击"以游客身份进入"

**预期结果**:
- [ ] 显示登录演示动画
- [ ] 自动跳转到首页
- [ ] 可以浏览内容（但不能发帖）

## 🔍 边界测试

### 测试 8: 错误邮箱格式

**测试用例**:
- [ ] 空邮箱 → 提示"请输入邮箱地址"
- [ ] 无 @ 符号 → 提示"请输入有效的邮箱地址"
- [ ] 无域名 → 提示"请输入有效的邮箱地址"

### 测试 9: 错误验证码

**测试用例**:
- [ ] 空验证码 → 提示"请输入验证码"
- [ ] 少于 6 位 → 提示"验证码为6位数字"
- [ ] 错误验证码 → 提示"验证码错误或已过期"

### 测试 10: 验证码过期

**步骤**:
1. 发送验证码
2. 等待 60 秒以上
3. 输入验证码并登录

**预期结果**:
- [ ] 提示"验证码错误或已过期，请重新获取"

### 测试 11: 频率限制

**步骤**:
1. 连续发送 4 次验证码到同一邮箱

**预期结果**:
- [ ] 第 4 次提示"发送验证码过于频繁"
- [ ] 显示等待时间
- [ ] 按钮进入倒计时状态

## 📱 兼容性测试

### 浏览器测试

- [ ] Chrome (最新版)
- [ ] Firefox (最新版)
- [ ] Safari (最新版)
- [ ] Edge (最新版)

### 设备测试

- [ ] 桌面端
- [ ] 平板端
- [ ] 手机端

## 🎯 性能测试

### 测试 12: 加载速度

**检查项**:
- [ ] 页面加载时间 < 3 秒
- [ ] Supabase 脚本加载成功
- [ ] 配置检测自动运行

### 测试 13: 响应速度

**检查项**:
- [ ] 发送验证码响应 < 2 秒
- [ ] 验证码登录响应 < 2 秒
- [ ] 页面切换流畅

## 🔒 安全测试

### 测试 14: API Key 安全

**检查项**:
- [ ] 使用的是 anon public key（不是 service_role）
- [ ] Key 可以在前端代码中看到（这是正常的）
- [ ] 数据访问受 RLS 策略保护

### 测试 15: 验证码安全

**检查项**:
- [ ] 验证码只能使用一次
- [ ] 验证码有过期时间
- [ ] 无法暴力破解验证码

## 📊 测试结果记录

### 通过的测试

```
✅ 测试 1: 发送验证码
✅ 测试 2: 接收验证码邮件
✅ 测试 3: 验证码登录
✅ 测试 4: 自动创建用户
✅ 测试 5: 会话保持
✅ 测试 6: 登出功能
✅ 测试 7: 游客模式
```

### 失败的测试

```
记录失败的测试和错误信息
```

### 需要改进的地方

```
记录需要优化的功能
```

## 🐛 问题排查

### 如果所有测试都失败

1. 运行配置检查：
```javascript
checkSupabaseConfig()
```

2. 运行连接测试：
```javascript
testSupabaseConnection()
```

3. 查看完整诊断：
```javascript
diagnoseSupabase()
```

### 如果只有邮件发送失败

1. 检查垃圾邮件文件夹
2. 尝试使用 Gmail 邮箱
3. 查看 Supabase Dashboard → Logs
4. 考虑配置自定义 SMTP

### 如果验证码验证失败

1. 确保在 60 秒内输入
2. 检查验证码是否正确（6 位数字）
3. 重新发送验证码
4. 检查网络连接

## 📝 测试报告模板

```markdown
## 测试报告

**测试日期**: YYYY-MM-DD
**测试人员**: [姓名]
**测试环境**: [浏览器/设备]

### 配置信息
- Supabase URL: ✅ 正确
- API Key: ✅ 已配置
- SMTP: ⏳ 未配置（使用默认）

### 测试结果
- 发送验证码: ✅ 通过
- 接收邮件: ✅ 通过
- 验证码登录: ✅ 通过
- 自动创建用户: ✅ 通过
- 会话保持: ✅ 通过
- 登出功能: ✅ 通过
- 游客模式: ✅ 通过

### 发现的问题
1. [问题描述]
2. [问题描述]

### 建议
1. [改进建议]
2. [改进建议]
```

## 🎉 测试完成

如果所有测试都通过，恭喜！邮箱验证码功能已经可以正常使用了。

如果有测试失败，请查看相关文档：
- [QUICK_CONFIG_GUIDE.md](QUICK_CONFIG_GUIDE.md)
- [EMAIL_VERIFICATION_SETUP.md](EMAIL_VERIFICATION_SETUP.md)
- [CHANGES_SUMMARY.md](CHANGES_SUMMARY.md)

---

**祝测试顺利！** 🚀











