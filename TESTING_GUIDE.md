# 快速测试指南 - 邮箱验证码登录

## 🚀 快速开始

### 1. 启动应用
```bash
# 如果有本地服务器
npm start
# 或直接打开 index.html
```

### 2. 测试登录功能

#### 步骤：
1. 打开应用，进入登录页面
2. 输入您的邮箱地址（例如：test@gmail.com）
3. 点击"发送验证码"按钮
4. 等待按钮显示倒计时（60秒）
5. 检查邮箱收件箱，查找验证码邮件
6. 输入6位验证码
7. 点击"登录"按钮
8. 验证是否成功跳转到首页

#### 预期结果：
- ✅ 邮箱输入框正常显示
- ✅ 点击"发送验证码"后显示"发送中..."
- ✅ 成功后显示验证码输入框
- ✅ 按钮显示倒计时"重新发送(60秒)"
- ✅ 输入验证码后可以登录
- ✅ 登录成功后跳转到首页
- ✅ 显示"登录成功！欢迎回来 🎉"提示

### 3. 测试注册功能

#### 步骤：
1. 在登录页面点击"没有账号？去注册"
2. 输入新的邮箱地址
3. 点击"发送验证码"按钮
4. 检查邮箱，获取验证码
5. 输入验证码
6. 点击"验证并登录"按钮
7. 验证是否成功创建账号并登录

#### 预期结果：
- ✅ 切换到注册模式
- ✅ 表单显示正确（只有邮箱和验证码）
- ✅ 发送验证码功能正常
- ✅ 新邮箱可以成功注册
- ✅ 注册后自动登录
- ✅ 显示"欢迎！🎉"提示

### 4. 测试邮箱自动补全

#### 步骤：
1. 在邮箱输入框输入：test@
2. 观察是否显示邮箱建议列表
3. 点击建议的邮箱后缀
4. 验证是否自动填充完整邮箱

#### 预期结果：
- ✅ 输入 @ 后显示建议列表
- ✅ 显示 gmail.com、outlook.com、163.com、qq.com
- ✅ 点击建议后自动填充
- ✅ 点击外部区域关闭建议列表

### 5. 测试验证码倒计时

#### 步骤：
1. 发送验证码
2. 观察按钮文字变化
3. 等待60秒
4. 验证按钮是否恢复可用状态

#### 预期结果：
- ✅ 发送后按钮显示"重新发送(60秒)"
- ✅ 倒计时每秒递减
- ✅ 倒计时期间按钮禁用
- ✅ 倒计时结束后按钮恢复"发送验证码"
- ✅ 按钮重新可用

### 6. 测试错误处理

#### 测试场景 A：空邮箱
1. 不输入邮箱，直接点击"发送验证码"
2. 预期：显示"请输入邮箱地址"错误提示

#### 测试场景 B：无效邮箱
1. 输入无效邮箱（如：test）
2. 点击"发送验证码"
3. 预期：显示"请输入有效的邮箱地址"错误提示

#### 测试场景 C：空验证码
1. 发送验证码后，不输入验证码
2. 直接点击"登录"
3. 预期：显示"请输入验证码"错误提示

#### 测试场景 D：错误验证码
1. 输入错误的验证码（如：123456）
2. 点击"登录"
3. 预期：显示"验证码错误或已过期"错误提示

#### 测试场景 E：频率限制
1. 连续多次点击"发送验证码"
2. 预期：显示"发送验证码过于频繁"错误提示

### 7. 测试登出功能

#### 步骤：
1. 登录后进入个人中心
2. 点击"退出登录"
3. 验证是否返回登录页面
4. 验证表单是否重置

#### 预期结果：
- ✅ 成功退出登录
- ✅ 返回登录页面
- ✅ 验证码输入框隐藏
- ✅ 登录按钮隐藏
- ✅ "发送验证码"按钮显示
- ✅ 上次登录的邮箱保留（方便下次登录）

### 8. 测试游客模式

#### 步骤：
1. 在登录页面点击"以游客身份进入"
2. 验证是否直接进入应用

#### 预期结果：
- ✅ 跳过登录流程
- ✅ 直接进入首页
- ✅ 显示游客用户信息

## 🐛 常见问题排查

### 问题1：收不到验证码邮件
**排查步骤：**
1. 检查控制台是否有错误信息
2. 确认邮箱地址正确
3. 检查垃圾邮件文件夹
4. 确认网络连接正常
5. 确认 Supabase 服务正常

### 问题2：验证码验证失败
**排查步骤：**
1. 确认验证码输入正确（6位数字）
2. 检查验证码是否过期（60秒有效期）
3. 尝试重新获取验证码
4. 查看控制台错误信息

### 问题3：按钮一直显示"发送中..."
**排查步骤：**
1. 检查网络连接
2. 查看控制台错误信息
3. 刷新页面重试
4. 确认 Supabase 配置正确

### 问题4：倒计时不工作
**排查步骤：**
1. 检查浏览器控制台是否有 JavaScript 错误
2. 确认 auth.js 文件加载正常
3. 刷新页面重试

## 📊 测试检查清单

- [ ] 登录页面正常显示
- [ ] 邮箱输入框正常工作
- [ ] 邮箱自动补全功能正常
- [ ] "发送验证码"按钮正常工作
- [ ] 验证码输入框正常显示
- [ ] 验证码倒计时正常工作
- [ ] 登录功能正常
- [ ] 注册页面正常显示
- [ ] 注册功能正常
- [ ] 错误提示正常显示
- [ ] 登出功能正常
- [ ] 游客模式正常
- [ ] 页面切换正常
- [ ] 个人中心显示正确的用户信息

## 🔍 调试技巧

### 查看控制台日志
```javascript
// 打开浏览器控制台（F12）
// 查看以下日志：
// 📧 ========== 发送登录验证码 ==========
// 🔐 ========== 验证码登录 ==========
// ✅ 登录成功！
```

### 检查网络请求
```javascript
// 在控制台 Network 标签中查看：
// - signInWithOtp 请求
// - verifyOtp 请求
// 确认请求状态为 200
```

### 测试 Supabase 连接
```javascript
// 在控制台输入：
console.log(window.supabase);
// 应该显示 Supabase 客户端对象
```

## ✅ 测试完成

如果所有测试都通过，说明邮箱验证码登录功能已成功实现！

---

**测试日期**: 2026-02-09
**测试版本**: v2.0

